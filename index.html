<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>QR Attendance Scanner</title>
<style>
body { font-family: sans-serif; background: #111; color: #eee; margin: 0; padding: 1rem; }
h1 { font-size: 1.5rem; margin-bottom: 1rem; }
button, select, label { margin: 0.25rem 0; padding: 0.5rem; border-radius: 6px; border: none; }
button { cursor: pointer; }
table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
th, td { border: 1px solid #555; padding: 0.5rem; word-break: break-word; }
video { width: 100%; max-height: 240px; background: black; border-radius: 8px; }
.controls { margin: 0.5rem 0; display: flex; flex-wrap: wrap; gap: 0.5rem; }
.msg { margin-top: 0.5rem; color: yellow; }
</style>
<script src="https://unpkg.com/@zxing/browser@latest"></script>
</head>
<body>
<h1>QR Attendance Scanner</h1>


<div>
<label for="deviceSelect">Camera device</label><br>
<select id="deviceSelect"></select>
</div>
<div class="controls">
<button id="startBtn">Start camera</button>
<button id="stopBtn">Stop camera</button>
<button id="exportBtn">Export CSV</button>
<label style="background:#555; color:#fff; padding:0.5rem; cursor:pointer;">
Import JSON<input type="file" id="importFile" accept="application/json" style="display:none">
</label>
<button id="clearBtn">Clear data</button>
</div>
<div class="msg" id="msg"></div>


<video id="preview" playsinline muted></video>


<div>
<h3>Last scanned</h3>
<div id="lastScan">No scans yet</div>
</div>


<div>
<h3>Scanned codes summary</h3>
<div style="max-height:300px; overflow:auto">
<table id="scanTable">
<thead>
<tr><th>Code</th><th>First seen</th></tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>


<script>
const preview = document.getElementById('preview');
const deviceSelect = document.getElementById('deviceSelect');
const msg = document.getElementById('msg');
const lastScanDiv = document.getElementById('lastScan');
const tableBody = document.querySelector('#scanTable tbody');


let codeReader = null;
let scans = JSON.parse(localStorage.getItem('qr_scans')||'{}');


function renderTable(){
tableBody.innerHTML = '';
Object.entries(scans).sort((a,b)=>b[1].firstSeen.localeCompare(a[1].firstSeen)).forEach(([code,e])=>{
const tr = document.createElement('tr');
</html>