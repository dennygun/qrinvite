<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Attendance Scanner</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #reader { width: 300px; margin: auto; }
    #log { margin-top: 20px; max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; }
  </style>
</head>
<body>
  <h1>QR Attendance Scanner</h1>
  <div id="reader"></div>
  <div id="log"></div>

  <script>
    const logDiv = document.getElementById("log");
    let lastScanTime = 0;
    const scanInterval = 3000; // 3 seconds debounce

    // Google Apps Script endpoint (replace with your deployed web app URL)
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbw1Kj_uNOxmgmfihNzL91eHm-0AbBnxKsCA_-HYMMawNjaXihuvpCaZc5XF1X5aRbjV/exec";

    function logMessage(msg) {
      const p = document.createElement("p");
      p.textContent = msg;
      logDiv.prepend(p);
    }

    function sendToSheet(qrCode) {
      fetch(SHEET_URL, {
        method: "POST",
        body: JSON.stringify({ code: qrCode }),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.text())
      .then(data => logMessage("Saved: " + data))
      .catch(err => logMessage("Error: " + err));
    }

    function onScanSuccess(decodedText) {
      const now = Date.now();
      if (now - lastScanTime < scanInterval) {
        return; // prevent multiple scans
      }
      lastScanTime = now;

      logMessage("Scanned: " + decodedText);
      sendToSheet(decodedText);
    }

    function onScanFailure(error) {
      // ignore, scanner keeps running
    }

    const html5QrCode = new Html5Qrcode("reader");
    Html5Qrcode.getCameras().then(cameras => {
      if (cameras && cameras.length) {
        html5QrCode.start(
          cameras[0].id,
          { fps: 10, qrbox: 250 },
          onScanSuccess,
          onScanFailure
        );
      }
    }).catch(err => logMessage("Camera error: " + err));
  </script>
</body>
</html>

